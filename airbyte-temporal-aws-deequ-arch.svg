<svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1200" height="800" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="600" y="30" font-family="Arial, sans-serif" font-size="22" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Airbyte + Temporal + AWS Deequ Data Quality Pipeline
  </text>
  
  <!-- Arrow Definitions -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="6" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <polygon points="0 0, 10 3, 0 6" fill="#2c3e50"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="6" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <polygon points="0 0, 10 3, 0 6" fill="#27ae60"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="6" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <polygon points="0 0, 10 3, 0 6" fill="#e74c3c"/>
    </marker>
    <marker id="arrowBlue" markerWidth="10" markerHeight="6" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <polygon points="0 0, 10 3, 0 6" fill="#3498db"/>
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="6" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <polygon points="0 0, 10 3, 0 6" fill="#f39c12"/>
    </marker>
  </defs>
  
  <!-- 1. Snowflake (Top Left) -->
  <g id="snowflake">
    <rect x="80" y="100" width="140" height="80" rx="10" fill="#29b5e8" stroke="#1a8cb8" stroke-width="2"/>
    <path d="M 150 125 L 160 135 L 150 145 L 140 135 Z M 150 115 L 170 135 L 150 155 L 130 135 Z" 
          fill="white"/>
    <text x="150" y="170" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Snowflake</text>
  </g>
  
  <!-- 2. Airbyte (Center Left) -->
  <g id="airbyte">
    <rect x="320" y="100" width="140" height="80" rx="10" fill="#6c5ce7" stroke="#5a4fcf" stroke-width="2"/>
    <circle cx="390" cy="130" r="12" fill="white"/>
    <path d="M 380 130 L 400 130 M 390 120 L 390 140" stroke="#6c5ce7" stroke-width="2"/>
    <text x="390" y="170" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Airbyte</text>
  </g>
  
  <!-- 3. S3 Raw Data (Top Center) -->
  <g id="s3-raw">
    <rect x="560" y="100" width="140" height="80" rx="10" fill="#ff9f43" stroke="#ff7675" stroke-width="2"/>
    <path d="M 620 120 Q 630 115 640 120 Q 630 125 620 120 Z M 620 130 Q 630 135 640 130 M 620 140 Q 630 145 640 140" 
          fill="white" stroke="white"/>
    <text x="630" y="170" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">S3 Raw Data</text>
  </g>
  
  <!-- 4. Temporal Server (Center) -->
  <g id="temporal">
    <rect x="320" y="250" width="140" height="80" rx="10" fill="#00b894" stroke="#00a085" stroke-width="2"/>
    <circle cx="370" cy="280" r="6" fill="white"/>
    <circle cx="390" cy="280" r="6" fill="white"/>
    <circle cx="410" cy="280" r="6" fill="white"/>
    <text x="390" y="320" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Temporal</text>
  </g>
  
  <!-- 5. AWS Batch (Right Center) -->
  <g id="batch">
    <rect x="560" y="250" width="140" height="80" rx="10" fill="#fd79a8" stroke="#e84393" stroke-width="2"/>
    <rect x="615" y="270" width="30" height="4" rx="1" fill="white"/>
    <rect x="615" y="280" width="30" height="4" rx="1" fill="white"/>
    <rect x="615" y="290" width="30" height="4" rx="1" fill="white"/>
    <text x="630" y="320" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">AWS Batch</text>
  </g>
  
  <!-- 6. Deequ Container (Far Right) -->
  <g id="deequ">
    <rect x="800" y="250" width="140" height="80" rx="10" fill="#a29bfe" stroke="#6c5ce7" stroke-width="2"/>
    <rect x="855" y="270" width="30" height="20" rx="3" fill="white"/>
    <circle cx="870" cy="280" r="3" fill="#a29bfe"/>
    <text x="870" y="320" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Deequ</text>
  </g>
  
  <!-- 7. S3 DQ Results (Bottom Center) -->
  <g id="s3-results">
    <rect x="560" y="400" width="140" height="80" rx="10" fill="#fdcb6e" stroke="#e17055" stroke-width="2"/>
    <path d="M 620 420 Q 630 415 640 420 Q 630 425 620 420 Z M 620 430 Q 630 435 640 430 M 620 440 Q 630 445 640 440" 
          fill="white" stroke="white"/>
    <text x="630" y="470" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">DQ Results</text>
  </g>
  
  <!-- 8. Destination (Bottom Right) -->
  <g id="destination">
    <rect x="980" y="100" width="140" height="80" rx="10" fill="#74b9ff" stroke="#0984e3" stroke-width="2"/>
    <rect x="1035" y="120" width="30" height="25" rx="2" fill="white"/>
    <rect x="1040" y="125" width="20" height="3" fill="#74b9ff"/>
    <rect x="1040" y="130" width="20" height="3" fill="#74b9ff"/>
    <rect x="1040" y="135" width="20" height="3" fill="#74b9ff"/>
    <text x="1050" y="170" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Destination</text>
  </g>
  

  
  <!-- MAIN FLOW ARROWS WITH CLEAN PATHS -->
  
  <!-- 1. Extract: Snowflake → Airbyte -->
  <path d="M 220 140 L 320 140" stroke="#2c3e50" stroke-width="3" fill="none" marker-end="url(#arrow)"/>
  <text x="270" y="125" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#2c3e50">Extract</text>
  
  <!-- 2. Stage: Airbyte → S3 Raw -->
  <path d="M 460 140 L 560 140" stroke="#2c3e50" stroke-width="3" fill="none" marker-end="url(#arrow)"/>
  <text x="510" y="125" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#2c3e50">Stage</text>
  
  <!-- 3. Trigger: Airbyte → Temporal -->
  <path d="M 390 180 L 390 250" stroke="#2c3e50" stroke-width="3" fill="none" marker-end="url(#arrow)"/>
  <text x="370" y="200" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#2c3e50">Trigger</text>
  
  <!-- 4. Submit Job: Temporal → AWS Batch -->
  <path d="M 460 290 L 560 290" stroke="#2c3e50" stroke-width="3" fill="none" marker-end="url(#arrow)"/>
  <text x="510" y="275" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#2c3e50">Submit</text>
  
  <!-- 5. Start Container: AWS Batch → Deequ -->
  <path d="M 700 290 L 800 290" stroke="#2c3e50" stroke-width="3" fill="none" marker-end="url(#arrow)"/>
  <text x="750" y="275" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#2c3e50">Start</text>
  
  <!-- 6. Read Data: S3 Raw → Deequ -->
  <path d="M 700 140 Q 750 140 800 190 Q 850 240 850 250" stroke="#f39c12" stroke-width="3" fill="none" marker-end="url(#arrowOrange)" stroke-dasharray="5,3"/>
  <text x="775" y="160" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#f39c12">Read</text>
  
  <!-- 7. Save Results: Deequ → S3 Results -->
  <path d="M 850 330 Q 750 370 700 420" stroke="#a29bfe" stroke-width="3" fill="none" marker-end="url(#arrowBlue)"/>
  <text x="775" y="385" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#a29bfe">Results</text>

  <!-- 7b. Status Update: S3 Results → Temporal -->
  <path d="M 560 440 Q 460 440 390 330" stroke="#3498db" stroke-width="2" fill="none" marker-end="url(#arrowBlue)" stroke-dasharray="4,2"/>
  <text x="475" y="470" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#3498db">Status Update</text>
  
  <!-- 8. Status Update: S3 Results → Temporal -->
  <path d="M 560 440 Q 460 440 390 330" stroke="#3498db" stroke-width="2" fill="none" marker-end="url(#arrowBlue)" stroke-dasharray="4,2"/>
  <text x="475" y="460" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#3498db">8. Status</text>
  
  <!-- SUCCESS PATH -->
  <!-- 9a. DQ Results: Temporal → Airbyte -->
  <path d="M 320 290 Q 280 230 320 180" stroke="#27ae60" stroke-width="3" fill="none" marker-end="url(#arrowGreen)"/>
  <text x="280" y="235" font-family="Arial, sans-serif" font-size="11" font-weight="bold" text-anchor="middle" fill="#27ae60">9a. DQ OK</text>
  
  <!-- 9b. Load Success: Airbyte → Destination -->
  <path d="M 460 120 Q 720 80 980 120" stroke="#27ae60" stroke-width="4" fill="none" marker-end="url(#arrowGreen)"/>
  <text x="720" y="70" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#27ae60">LOAD (Airbyte Format)</text>

  
  <!-- Flow Numbers in Circles - Properly positioned -->
  <circle cx="270" cy="140" r="12" fill="#e74c3c" stroke="white" stroke-width="2"/>
  <text x="270" y="145" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">1</text>
  
  <circle cx="510" cy="140" r="12" fill="#e74c3c" stroke="white" stroke-width="2"/>
  <text x="510" y="145" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">2</text>
  
  <circle cx="370" cy="215" r="12" fill="#e74c3c" stroke="white" stroke-width="2"/>
  <text x="370" y="220" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">3</text>
  
  <circle cx="510" cy="290" r="12" fill="#e74c3c" stroke="white" stroke-width="2"/>
  <text x="510" y="295" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">4</text>
  
  <circle cx="750" cy="290" r="12" fill="#e74c3c" stroke="white" stroke-width="2"/>
  <text x="750" y="295" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">5</text>
  
  <circle cx="775" cy="180" r="12" fill="#f39c12" stroke="white" stroke-width="2"/>
  <text x="775" y="185" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">6</text>
  
  <circle cx="775" cy="350" r="12" fill="#a29bfe" stroke="white" stroke-width="2"/>
  <text x="775" y="355" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">7</text>
  
  <circle cx="475" cy="440" r="12" fill="#3498db" stroke="white" stroke-width="2"/>
  <text x="475" y="445" font-family="Arial, sans-serif" font-size="10" font-weight="bold" text-anchor="middle" fill="white">8</text>
  
  <circle cx="250" cy="195" r="12" fill="#27ae60" stroke="white" stroke-width="2"/>
  <text x="250" y="200" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">9a</text>
  
  <circle cx="340" cy="195" r="12" fill="#e74c3c" stroke="white" stroke-width="2"/>
  <text x="340" y="200" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">9b</text>
  
  <circle cx="720" cy="85" r="12" fill="#27ae60" stroke="white" stroke-width="2"/>
  <text x="720" y="90" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">10</text>
  
  <!-- Decision Point - Clean -->
  <polygon points="390,350 410,370 390,390 370,370" fill="#f39c12" stroke="#e67e22" stroke-width="2"/>
  <text x="390" y="375" font-family="Arial, sans-serif" font-size="9" font-weight="bold" text-anchor="middle" fill="white">DQ</text>
  <text x="390" y="385" font-family="Arial, sans-serif" font-size="8" text-anchor="middle" fill="white">Check</text>
  
  <!-- Key/Legend -->
  <rect x="50" y="550" width="1100" height="180" rx="10" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="1"/>
  <text x="70" y="575" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#2c3e50">Clean Operational Flow:</text>
  
  <text x="70" y="600" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
    <tspan font-weight="bold" fill="#e74c3c">1-2:</tspan> Airbyte extracts from Snowflake and stages raw data in S3 (Parquet format)
  </text>
  <text x="70" y="620" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
    <tspan font-weight="bold" fill="#e74c3c">3-4:</tspan> Airbyte triggers Temporal workflow → Temporal submits AWS Batch job for DQ validation
  </text>
  <text x="70" y="640" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
    <tspan font-weight="bold" fill="#e74c3c">5-6:</tspan> AWS Batch starts Deequ container → Deequ reads raw data from S3 for quality checks
  </text>
  <text x="70" y="660" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
    <tspan font-weight="bold" fill="#e74c3c">7-8:</tspan> Deequ saves quality results to S3 → Temporal receives completion status
  </text>
  <text x="70" y="680" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
    <tspan font-weight="bold" fill="#e74c3c">9a/9b:</tspan> Temporal sends DQ SUCCESS or DQ FAILURE to Airbyte source connector
  </text>
  <text x="70" y="700" font-family="Arial, sans-serif" font-size="12" fill="#27ae60">
    <tspan font-weight="bold">10:</tspan> Only if 9a SUCCESS → Airbyte loads data to destination in Airbyte message format
  </text>
  
  <text x="600" y="600" font-family="Arial, sans-serif" font-size="12" fill="#27ae60">
    <tspan font-weight="bold">9a - Success:</tspan> Airbyte receives DQ SUCCESS → Continues to step 10 (load data)
  </text>
  <text x="600" y="620" font-family="Arial, sans-serif" font-size="12" fill="#e74c3c">
    <tspan font-weight="bold">9b - Failure:</tspan> Airbyte receives DQ FAILURE → Exits with error (native error handling)
  </text>
  <text x="600" y="640" font-family="Arial, sans-serif" font-size="12" fill="#3498db">
    <tspan font-weight="bold">Temporal Retries:</tspan> Handles transient DQ process failures (network, compute issues)
  </text>
  <text x="600" y="660" font-family="Arial, sans-serif" font-size="12" fill="#74b9ff">
    <tspan font-weight="bold">Clean Design:</tspan> Both success and failure paths in step 9 - single decision point
  </text>
  
  <rect x="70" y="700" width="1070" height="20" rx="5" fill="#34495e"/>
  <text x="80" y="714" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">
    Airbyte source connector controls the pipeline flow based on DQ results | Temporal handles DQ orchestration and retries | Clean separation of concerns
  </text>
</svg>
